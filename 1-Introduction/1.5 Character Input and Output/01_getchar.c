/*
 * ============================================================================
 * Chapter 1: Introduction
 * Section 1.5: Character Input and Output
 * Topic: getchar
 * ============================================================================
 * 
 * ما هي getchar؟
 * ---------------
 * getchar() دالة تقرأ حرفاً واحداً من المدخلات (عادة من لوحة المفاتيح).
 * تُرجع الحرف المقروء كعدد صحيح (int).
 * 
 * لماذا مهمة؟
 * -----------
 * - أساس قراءة المدخلات النصية في C
 * - بسيطة لكن قوية جداً
 * - أساس بناء برامج تفاعلية
 * - تستخدم لبناء دوال قراءة أكثر تعقيداً
 * 
 * كيف تعمل؟
 * ----------
 * 1. تنتظر المستخدم أن يكتب حرفاً ويضغط Enter
 * 2. تقرأ حرفاً واحداً فقط
 * 3. تُرجع الحرف كقيمة عددية (رمز ASCII)
 * 4. تُرجع EOF عند نهاية المدخلات
 * 
 * ============================================================================
 */

/*
 * EOF: رمز خاص يعني "End Of File" (نهاية الملف)
 * يُستخدم للإشارة إلى نهاية المدخلات
 * قيمته عادةً -1
 */
#define EOF (-1)


main()
{
    /*
     * ============================================================================
     * مثال أساسي: قراءة وطباعة حرف واحد
     * ============================================================================
     */
    
    int c;  /* لاحظ: نستخدم int وليس char */
    
    printf("Example 1: Reading one character\n");
    printf("================================\n");
    printf("Enter a character: ");
    
    /*
     * قراءة حرف واحد:
     * ---------------
     * c = getchar();
     * 
     * لماذا نستخدم int وليس char؟
     * - getchar() تُرجع int
     * - لأنها تحتاج أن تُرجع EOF (قيمة خاصة لنهاية المدخلات)
     * - EOF ليست حرفاً عادياً، هي قيمة خاصة (عادة -1)
     * - int يمكنه تخزين كل الأحرف + EOF
     */
    c = getchar();
    
    printf("You entered: %c\n", c);  /* %c لطباعة كحرف */
    printf("ASCII value: %d\n\n", c);  /* %d لطباعة كرقم */
    
    
    /*
     * ============================================================================
     * مثال: نسخ المدخلات للمخرجات (Character by Character)
     * ============================================================================
     * 
     * هذا من أهم الأمثلة في K&R
     * البرنامج يقرأ كل حرف ويطبعه مباشرة
     */
    
    printf("Example 2: Copy input to output\n");
    printf("===============================\n");
    printf("Enter text (Ctrl+D to end):\n");
    
    /*
     * النسخة الأولى: باستخدام متغير مؤقت
     * ----------------------------------------
     */
    c = getchar();              /* اقرأ حرف */
    
    while (c != EOF) {          /* طالما ليس نهاية المدخلات */
        /*
         * الشرط c != EOF يعني:
         * - استمر طالما لم نصل لنهاية المدخلات
         * - EOF يُدخل بالضغط على Ctrl+D في Unix/Linux
         * - أو Ctrl+Z في Windows
         */
        
        putchar(c);             /* اطبع الحرف */
        c = getchar();          /* اقرأ الحرف التالي */
    }
    
    printf("\n\n");
    
    
    /*
     * ============================================================================
     * النسخة المُحسّنة: إسناد داخل الشرط
     * ============================================================================
     * 
     * في C، يمكننا وضع الإسناد داخل الشرط
     * هذا أسلوب شائع جداً في K&R
     */
    
    printf("Example 3: Compact version\n");
    printf("==========================\n");
    printf("Enter text (Ctrl+D to end):\n");
    
    /*
     * while ((c = getchar()) != EOF)
     * 
     * تشريح هذا السطر:
     * ----------------
     * 1. (c = getchar())     - اقرأ حرف وخزنه في c
     * 2. الأقواس ضرورية لأولوية العمليات
     * 3. != EOF              - قارن النتيجة مع EOF
     * 4. إذا ليس EOF، نفذ محتوى الحلقة
     * 
     * لماذا الأقواس؟
     * - بدونها: c = getchar() != EOF
     * - ستُقارن getchar() مع EOF أولاً
     * - ثم تُسند نتيجة المقارنة (0 أو 1) إلى c
     * - هذا خطأ!
     * 
     * لماذا هذه الطريقة أفضل؟
     * - أقصر وأوضح
     * - كل ما نحتاجه في سطر واحد
     * - أسلوب شائع في C
     */
    while ((c = getchar()) != EOF) {
        putchar(c);
    }
    
    printf("\n\n");
}


/*
 * ============================================================================
 * أمثلة عملية على getchar
 * ============================================================================
 */

example_count_characters()
{
    /*
     * مثال: عد عدد الأحرف في المدخلات
     * -----------------------------------
     */
    
    long nc;  /* عداد الأحرف - نستخدم long للأعداد الكبيرة */
    int c;
    
    printf("Example 4: Count characters\n");
    printf("===========================\n");
    printf("Enter text (Ctrl+D to end):\n");
    
    /*
     * nc = 0: نبدأ العد من صفر
     * لماذا مهم؟ بدون تهيئة، nc ستحتوي قيمة عشوائية
     */
    nc = 0;
    
    /*
     * نقرأ كل حرف ونعد
     */
    while ((c = getchar()) != EOF) {
        /*
         * ++nc تعني: زد nc بمقدار 1
         * مكافئة لـ: nc = nc + 1
         * لكن أقصر وأسرع
         */
        ++nc;
    }
    
    /*
     * %ld لطباعة long
     * d من decimal (عدد عشري)
     * l من long (عدد طويل)
     */
    printf("Character count: %ld\n\n", nc);
}


example_count_lines()
{
    /*
     * مثال: عد عدد الأسطر
     * ---------------------
     * السطر يُعرّف بأنه ينتهي بـ '\n'
     */
    
    long nl;  /* عداد الأسطر */
    int c;
    
    printf("Example 5: Count lines\n");
    printf("======================\n");
    printf("Enter text (Ctrl+D to end):\n");
    
    nl = 0;
    
    while ((c = getchar()) != EOF) {
        /*
         * نفحص إذا كان الحرف هو سطر جديد
         * '\n' يمثل حرف السطر الجديد (newline)
         * == للمقارنة (يساوي)
         */
        if (c == '\n') {
            /*
             * لماذا ++nl هنا؟
             * - فقط عندما نجد '\n' نعتبره سطر جديد
             * - باقي الأحرف نتجاهلها للعد
             */
            ++nl;
        }
    }
    
    printf("Line count: %ld\n\n", nl);
}


example_count_words()
{
    /*
     * مثال: عد الكلمات، الأسطر، والأحرف
     * -----------------------------------
     * محاكاة لأمر wc في Unix
     */
    
    long nc, nl, nw;  /* عدد الأحرف، الأسطر، الكلمات */
    int c;
    int inword;       /* 1 إذا كنا داخل كلمة، 0 خلاف ذلك */
    
    #define YES 1
    #define NO 0
    
    printf("Example 6: Word count (like wc)\n");
    printf("================================\n");
    printf("Enter text (Ctrl+D to end):\n");
    
    /*
     * تهيئة العدادات:
     */
    nc = nl = nw = 0;
    /*
     * في البداية، لسنا داخل كلمة
     */
    inword = NO;
    
    while ((c = getchar()) != EOF) {
        /*
         * عد كل الأحرف
         */
        ++nc;
        
        /*
         * عد الأسطر
         */
        if (c == '\n') {
            ++nl;
        }
        
        /*
         * عد الكلمات:
         * -----------
         * الكلمة تُعرّف بأنها متتالية من الأحرف غير المسافات
         * نعد الكلمة عندما ننتقل من "داخل كلمة" إلى "خارج كلمة"
         */
        
        /*
         * هل الحرف الحالي مسافة أو tab أو سطر جديد؟
         * || تعني "أو" (OR)
         */
        if (c == ' ' || c == '\n' || c == '\t') {
            /*
             * إذا كنا داخل كلمة، معنى هذا أن الكلمة انتهت
             */
            if (inword == YES) {
                inword = NO;    /* خرجنا من الكلمة */
                ++nw;           /* عد الكلمة */
            }
        }
        else {
            /*
             * الحرف ليس مسافة
             * إذا لم نكن داخل كلمة، معنى هذا أن كلمة جديدة بدأت
             */
            if (inword == NO) {
                inword = YES;   /* دخلنا كلمة جديدة */
            }
        }
    }
    
    /*
     * طباعة النتائج بنفس تنسيق wc
     */
    printf("%ld %ld %ld\n\n", nl, nw, nc);
}


/*
 * ============================================================================
 * تمرين: فحص نوع الحرف
 * ============================================================================
 */

example_character_types()
{
    int c;
    int digits;   /* عدد الأرقام */
    int letters;  /* عدد الحروف */
    int spaces;   /* عدد المسافات */
    int others;   /* أحرف أخرى */
    
    printf("Example 7: Character type analysis\n");
    printf("===================================\n");
    printf("Enter text (Ctrl+D to end):\n");
    
    digits = letters = spaces = others = 0;
    
    while ((c = getchar()) != EOF) {
        /*
         * فحص نوع الحرف:
         * ---------------
         */
        
        /*
         * هل رقم؟ (0-9)
         * نفحص إذا كان الحرف بين '0' و '9'
         * && تعني "و" (AND)
         */
        if (c >= '0' && c <= '9') {
            ++digits;
        }
        /*
         * هل حرف صغير؟ (a-z)
         */
        else if (c >= 'a' && c <= 'z') {
            ++letters;
        }
        /*
         * هل حرف كبير؟ (A-Z)
         */
        else if (c >= 'A' && c <= 'Z') {
            ++letters;
        }
        /*
         * هل مسافة أو tab أو سطر جديد؟
         */
        else if (c == ' ' || c == '\t' || c == '\n') {
            ++spaces;
        }
        /*
         * أي شيء آخر
         */
        else {
            ++others;
        }
    }
    
    printf("\nAnalysis:\n");
    printf("Digits:  %d\n", digits);
    printf("Letters: %d\n", letters);
    printf("Spaces:  %d\n", spaces);
    printf("Others:  %d\n\n", others);
}


/*
 * ============================================================================
 * Expected Behavior (أمثلة على الاستخدام):
 * ============================================================================
 * 
 * Example 1:
 * ----------
 * Input: A
 * Output: 
 *   You entered: A
 *   ASCII value: 65
 * 
 * 
 * Example 2 & 3 (Copy):
 * ---------------------
 * Input: Hello World!
 * Output: Hello World!
 * 
 * 
 * Example 4 (Count characters):
 * ----------------------------
 * Input: Hello
 * Output: Character count: 5
 * 
 * 
 * Example 5 (Count lines):
 * ------------------------
 * Input: 
 *   Line 1
 *   Line 2
 *   Line 3
 * Output: Line count: 3
 * 
 * 
 * Example 6 (Word count):
 * ----------------------
 * Input: Hello World!
 * Output: 1 2 12
 *         (1 line, 2 words, 12 characters)
 * 
 * 
 * Example 7 (Character types):
 * ---------------------------
 * Input: Hello123!
 * Output:
 *   Digits:  3
 *   Letters: 5
 *   Spaces:  0
 *   Others:  1
 * 
 * ============================================================================
 * ملاحظات مهمة:
 * ============================================================================
 * 
 * 1. نوع المتغير:
 *    - دائماً استخدم int لتخزين نتيجة getchar()
 *    - ليس char، بسبب EOF
 * 
 * 2. EOF:
 *    - قيمة خاصة تعني نهاية المدخلات
 *    - عادةً -1
 *    - في Unix/Linux: Ctrl+D
 *    - في Windows: Ctrl+Z ثم Enter
 * 
 * 3. الأحرف كأرقام:
 *    - كل حرف له رمز ASCII
 *    - 'A' = 65, 'a' = 97, '0' = 48
 *    - يمكن مقارنتها كأرقام
 * 
 * 4. الإسناد في الشرط:
 *    - while ((c = getchar()) != EOF)
 *    - الأقواس ضرورية!
 *    - أسلوب شائع جداً في C
 * 
 * 5. المسافات البيضاء (Whitespace):
 *    - مسافة: ' '
 *    - Tab: '\t'
 *    - سطر جديد: '\n'
 * 
 * 6. العدادات:
 *    - استخدم long للأعداد الكبيرة
 *    - هيئ دائماً قبل الاستخدام
 *    - ++n أسرع من n = n + 1
 * 
 * ============================================================================
 */
