/*
 * ============================================================================
 * Chapter 1: Introduction
 * Section 1.9: Character Arrays
 * Topic: Strings
 * ============================================================================
 * 
 * ما هي النصوص (Strings) في C؟
 * -------------------------------
 * النص في C هو مصفوفة من الأحرف (char array) تنتهي بحرف خاص '\0'
 * 
 * لماذا مهمة؟
 * -----------
 * - النصوص أساسية في أي برنامج (أسماء، رسائل، مدخلات)
 * - فهمها ضروري لمعالجة البيانات النصية
 * - أساس الكثير من عمليات الإدخال والإخراج
 * 
 * خصائص النصوص في C:
 * --------------------
 * 1. مصفوفة من char
 * 2. تنتهي بـ '\0' (null character)
 * 3. يمكن التعامل معها حرفاً بحرف
 * 4. printf و scanf تفهمها مباشرة
 * 
 * ملاحظة مهمة:
 * ------------
 * C ليس لديها نوع "string" منفصل
 * النصوص هي مصفوفات أحرف بقواعد خاصة
 * 
 * ============================================================================
 */

/*
 * ============================================================================
 * مثال 1: إنشاء نص بسيط
 * ============================================================================
 */

main()
{
    /*
     * طريقة 1: تعريف نص كمصفوفة أحرف
     * ---------------------------------
     * 
     * char name[6];
     * 
     * لماذا 6 وليس 5؟
     * - نحتاج 5 أحرف لـ "Hello"
     * - نحتاج 1 حرف لـ '\0' (نهاية النص)
     * - المجموع: 6
     */
    char name[6];
    
    printf("Example 1: Building a string character by character\n");
    printf("====================================================\n\n");
    
    /*
     * ملء النص حرفاً بحرف:
     * ---------------------
     */
    name[0] = 'H';
    name[1] = 'e';
    name[2] = 'l';
    name[3] = 'l';
    name[4] = 'o';
    name[5] = '\0';  /* مهم جداً! هذا يُعلم النهاية */
    
    /*
     * طباعة النص:
     * -----------
     * %s تطبع نص (string)
     * تستمر في الطباعة حتى تجد '\0'
     */
    printf("The name is: %s\n\n", name);
    
    
    /*
     * ============================================================================
     * مثال 2: تهيئة نص مباشرة
     * ============================================================================
     */
    
    /*
     * طريقة أسهل:
     * -----------
     * نستخدم علامات التنصيص المزدوجة ""
     * المترجم يضيف '\0' تلقائياً!
     */
    char greeting[10];
    
    printf("Example 2: String initialization\n");
    printf("=================================\n\n");
    
    /*
     * للأسف، في K&R الأولى، لا يمكن إسناد نص مباشرة بعد التعريف:
     * greeting = "Hi";  ← خطأ!
     * 
     * يجب ملؤه حرفاً بحرف، أو تهيئته عند التعريف
     */
    
    
    /*
     * ============================================================================
     * مثال 3: قراءة نص من المستخدم
     * ============================================================================
     */
    
    char input[100];  /* مساحة كافية للمدخلات */
    int i;
    
    printf("Example 3: Reading a line\n");
    printf("=========================\n\n");
    printf("Enter a line of text:\n");
    
    /*
     * قراءة النص حرفاً بحرف:
     * -----------------------
     */
    i = 0;
    while ((input[i] = getchar()) != '\n' && i < 99) {
        /*
         * ماذا يحدث هنا؟
         * 1. getchar() تقرأ حرف
         * 2. نخزنه في input[i]
         * 3. نفحص إذا كان '\n' (سطر جديد)
         * 4. نفحص إذا وصلنا للحد الأقصى (99)
         * 
         * لماذا 99 وليس 100؟
         * - نحتاج مكان لـ '\0' في النهاية
         */
        ++i;
    }
    
    /*
     * إنهاء النص:
     * -----------
     * مهم جداً! بدون هذا، النص غير صحيح
     */
    input[i] = '\0';
    
    printf("\nYou entered: %s\n\n", input);
}


/*
 * ============================================================================
 * مثال عملي: إيجاد طول نص
 * ============================================================================
 */

/*
 * دالة تحسب طول نص:
 * ------------------
 * تعد الأحرف حتى تصل لـ '\0'
 */
int string_length(s)
char s[];
{
    int i;
    
    /*
     * نبدأ من أول حرف ونعد:
     */
    i = 0;
    while (s[i] != '\0') {
        /*
         * طالما لم نصل لـ '\0'، استمر في العد
         */
        ++i;
    }
    
    /*
     * عند الخروج من الحلقة، i يساوي عدد الأحرف
     * (لا يشمل '\0')
     */
    return i;
}


test_string_length()
{
    char text1[20];
    char text2[20];
    int len;
    
    printf("Example 4: String length\n");
    printf("========================\n\n");
    
    /*
     * تعبئة النصوص:
     */
    text1[0] = 'C';
    text1[1] = '\0';
    
    text2[0] = 'H';
    text2[1] = 'e';
    text2[2] = 'l';
    text2[3] = 'l';
    text2[4] = 'o';
    text2[5] = '\0';
    
    /*
     * حساب الطول:
     */
    len = string_length(text1);
    printf("'%s' has length %d\n", text1, len);
    
    len = string_length(text2);
    printf("'%s' has length %d\n\n", text2, len);
}


/*
 * ============================================================================
 * مثال: نسخ نص
 * ============================================================================
 */

/*
 * دالة تنسخ نص من مكان لآخر:
 * ----------------------------
 */
int string_copy(to, from)
char to[];
char from[];
{
    int i;
    
    i = 0;
    /*
     * ننسخ كل حرف، بما فيها '\0':
     */
    while ((to[i] = from[i]) != '\0') {
        /*
         * هذا السطر ذكي:
         * 1. نسخ from[i] إلى to[i]
         * 2. فحص إذا كان الحرف المنسوخ '\0'
         * 3. إذا لم يكن '\0'، نستمر
         * 
         * عندما ننسخ '\0'، الشرط يصبح خاطئ ونتوقف
         */
        ++i;
    }
}


test_string_copy()
{
    char source[20];
    char destination[20];
    
    printf("Example 5: String copy\n");
    printf("======================\n\n");
    
    /*
     * النص المصدر:
     */
    source[0] = 'C';
    source[1] = 'o';
    source[2] = 'p';
    source[3] = 'y';
    source[4] = '\0';
    
    printf("Source: %s\n", source);
    
    /*
     * النسخ:
     */
    string_copy(destination, source);
    
    printf("Destination: %s\n\n", destination);
}


/*
 * ============================================================================
 * مثال: مقارنة نصين
 * ============================================================================
 */

/*
 * دالة تقارن نصين:
 * -----------------
 * ترجع:
 * 0 إذا متطابقان
 * قيمة موجبة إذا s1 أكبر
 * قيمة سالبة إذا s2 أكبر
 */
int string_compare(s1, s2)
char s1[];
char s2[];
{
    int i;
    
    i = 0;
    /*
     * نقارن حرفاً بحرف:
     */
    while (s1[i] == s2[i]) {
        /*
         * إذا وصلنا لنهاية كلا النصين، هما متطابقان:
         */
        if (s1[i] == '\0') {
            return 0;
        }
        ++i;
    }
    
    /*
     * وجدنا اختلاف:
     * نرجع الفرق بين الحرفين
     */
    return s1[i] - s2[i];
}


test_string_compare()
{
    char str1[10];
    char str2[10];
    char str3[10];
    int result;
    
    printf("Example 6: String comparison\n");
    printf("============================\n\n");
    
    /*
     * تعبئة النصوص:
     */
    str1[0] = 'A';
    str1[1] = 'B';
    str1[2] = 'C';
    str1[3] = '\0';
    
    str2[0] = 'A';
    str2[1] = 'B';
    str2[2] = 'C';
    str2[3] = '\0';
    
    str3[0] = 'A';
    str3[1] = 'B';
    str3[2] = 'D';
    str3[3] = '\0';
    
    /*
     * المقارنات:
     */
    result = string_compare(str1, str2);
    printf("'%s' vs '%s': %d (equal)\n", str1, str2, result);
    
    result = string_compare(str1, str3);
    printf("'%s' vs '%s': %d (not equal)\n", str1, str3, result);
    
    printf("\n");
}


/*
 * ============================================================================
 * مثال: ربط نصين (concatenation)
 * ============================================================================
 */

/*
 * دالة تربط نص بآخر:
 * -------------------
 * تضيف s2 في نهاية s1
 */
int string_concat(s1, s2)
char s1[];
char s2[];
{
    int i, j;
    
    /*
     * إيجاد نهاية s1:
     */
    i = 0;
    while (s1[i] != '\0') {
        ++i;
    }
    
    /*
     * الآن i يشير لموقع '\0' في s1
     * ننسخ s2 بدءاً من هذا الموقع:
     */
    j = 0;
    while ((s1[i] = s2[j]) != '\0') {
        ++i;
        ++j;
    }
}


test_string_concat()
{
    char result[50];
    char part1[10];
    char part2[10];
    int i;
    
    printf("Example 7: String concatenation\n");
    printf("================================\n\n");
    
    /*
     * تعبئة النصوص:
     */
    part1[0] = 'H';
    part1[1] = 'e';
    part1[2] = 'l';
    part1[3] = 'l';
    part1[4] = 'o';
    part1[5] = '\0';
    
    part2[0] = 'W';
    part2[1] = 'o';
    part2[2] = 'r';
    part2[3] = 'l';
    part2[4] = 'd';
    part2[5] = '\0';
    
    /*
     * نسخ part1 إلى result:
     */
    string_copy(result, part1);
    
    /*
     * إضافة مسافة:
     */
    i = string_length(result);
    result[i] = ' ';
    result[i + 1] = '\0';
    
    /*
     * ربط part2:
     */
    string_concat(result, part2);
    
    printf("Result: %s\n\n", result);
}


/*
 * ============================================================================
 * مثال: قراءة أطول سطر
 * ============================================================================
 * 
 * هذا المثال الكلاسيكي من K&R
 */

#define MAXLINE 1000  /* أقصى طول للسطر */

/*
 * دالة تقرأ سطر:
 * ---------------
 * ترجع طول السطر
 */
int get_line(line, maxline)
char line[];
int maxline;
{
    int c, i;
    
    /*
     * قراءة الأحرف:
     */
    for (i = 0; i < maxline - 1 && (c = getchar()) != EOF && c != '\n'; ++i) {
        line[i] = c;
    }
    
    /*
     * إذا كان آخر حرف '\n'، نضيفه:
     */
    if (c == '\n') {
        line[i] = c;
        ++i;
    }
    
    /*
     * إنهاء النص:
     */
    line[i] = '\0';
    
    return i;
}


find_longest_line()
{
    int len;
    int max;
    char line[MAXLINE];
    char longest[MAXLINE];
    
    printf("Example 8: Finding longest line\n");
    printf("================================\n");
    printf("Enter lines (Ctrl+D to end):\n\n");
    
    max = 0;
    while ((len = get_line(line, MAXLINE)) > 0) {
        /*
         * إذا وجدنا سطر أطول:
         */
        if (len > max) {
            max = len;
            string_copy(longest, line);
        }
    }
    
    /*
     * طباعة النتيجة:
     */
    if (max > 0) {
        printf("\nLongest line (%d chars):\n", max);
        printf("%s", longest);
    }
}


/*
 * ============================================================================
 * Expected Output (أمثلة):
 * ============================================================================
 * Example 1: Building a string character by character
 * ====================================================
 * 
 * The name is: Hello
 * 
 * Example 2: String initialization
 * =================================
 * 
 * Example 3: Reading a line
 * =========================
 * 
 * Enter a line of text:
 * This is a test
 * 
 * You entered: This is a test
 * 
 * Example 4: String length
 * ========================
 * 
 * 'C' has length 1
 * 'Hello' has length 5
 * 
 * Example 5: String copy
 * ======================
 * 
 * Source: Copy
 * Destination: Copy
 * 
 * Example 6: String comparison
 * ============================
 * 
 * 'ABC' vs 'ABC': 0 (equal)
 * 'ABC' vs 'ABD': -1 (not equal)
 * 
 * Example 7: String concatenation
 * ================================
 * 
 * Result: Hello World
 * 
 * Example 8: Finding longest line
 * ================================
 * Enter lines (Ctrl+D to end):
 * 
 * short
 * this is a longer line
 * mid
 * 
 * Longest line (22 chars):
 * this is a longer line
 * 
 * ============================================================================
 * ملاحظات مهمة:
 * ============================================================================
 * 
 * 1. '\0' ضروري:
 *    - كل نص يجب أن ينتهي بـ '\0'
 *    - بدونه، الدوال لا تعرف أين ينتهي النص
 *    - printf قد تطبع "قمامة" إذا لم يوجد '\0'
 * 
 * 2. الحجم:
 *    - احجز دائماً مكان إضافي لـ '\0'
 *    - نص "Hello" يحتاج 6 خانات، ليس 5
 * 
 * 3. التهيئة:
 *    - علامات التنصيص "" تضيف '\0' تلقائياً
 *    - الملء اليدوي يحتاج '\0' يدوياً
 * 
 * 4. المقارنة:
 *    - لا يمكن: if (s1 == s2)
 *    - يجب: استخدام دالة مقارنة
 * 
 * 5. النسخ:
 *    - لا يمكن: s1 = s2;
 *    - يجب: استخدام دالة نسخ
 * 
 * 6. الأمان:
 *    - تحقق دائماً من حدود المصفوفة
 *    - تجنب الكتابة خارج الحدود
 * 
 * ============================================================================
 */
