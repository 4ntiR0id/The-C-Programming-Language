/*
 * ============================================================================
 * Chapter 1: Introduction
 * Section 1.7: Functions
 * Topic: Return values
 * ============================================================================
 * 
 * ما هي القيمة المُرجعة (Return Value)؟
 * ----------------------------------------
 * القيمة المُرجعة هي البيانات التي تُعيدها الدالة للمستدعي.
 * نستخدم أمر return لإرجاع هذه القيمة.
 * 
 * لماذا مهمة؟
 * -----------
 * - تسمح للدوال بحساب قيم وإعادتها للاستخدام
 * - تجعل الدوال أكثر مرونة
 * - تفصل الحساب عن الطباعة
 * - أساس بناء دوال قابلة لإعادة الاستخدام
 * 
 * الفرق بين الطباعة والإرجاع:
 * -----------------------------
 * - الطباعة: عرض القيمة على الشاشة فقط
 * - الإرجاع: إعطاء القيمة للمستدعي ليستخدمها كما يشاء
 * 
 * ============================================================================
 */

/*
 * ============================================================================
 * بنية return
 * ============================================================================
 * 
 * الصيغة:
 * -------
 * return expression;
 * 
 * - يُنهي تنفيذ الدالة فوراً
 * - يُرجع قيمة expression للمستدعي
 * - نوع القيمة المُرجعة يجب أن يطابق نوع الدالة
 * 
 * ============================================================================
 */


/*
 * ============================================================================
 * مثال 1: دالة ترجع عدد صحيح
 * ============================================================================
 */

/*
 * دالة تجمع عددين:
 * -----------------
 * 
 * int add(...): تُرجع int
 * return a + b: تُرجع مجموع a و b
 */
int add(a, b)
int a, b;
{
    /*
     * return يُنهي الدالة ويُرجع القيمة:
     */
    return a + b;
}


/*
 * دالة تطرح عددين:
 */
int subtract(a, b)
int a, b;
{
    return a - b;
}


/*
 * دالة تضرب عددين:
 */
int multiply(a, b)
int a, b;
{
    return a * b;
}


/*
 * دالة تقسم عددين:
 */
int divide(a, b)
int a, b;
{
    /*
     * يمكن فحص الشروط قبل الإرجاع:
     */
    if (b == 0) {
        printf("Error: Division by zero!\n");
        return 0;  /* نُرجع 0 في حالة الخطأ */
    }
    return a / b;
}


/*
 * ============================================================================
 * مثال 2: دالة القوة (power) مع return
 * ============================================================================
 */

/*
 * حساب base^n:
 * ------------
 * هذه المرة نُرجع القيمة بدلاً من طباعتها
 */
int power(base, n)
int base, n;
{
    int result;
    int i;
    
    result = 1;
    for (i = 0; i < n; i = i + 1) {
        result = result * base;
    }
    
    /*
     * نُرجع النتيجة:
     * المستدعي يقرر ماذا يفعل بها (طباعة، حفظ، استخدام في حساب آخر)
     */
    return result;
}


/*
 * ============================================================================
 * مثال 3: دالة تحويل Fahrenheit إلى Celsius مع return
 * ============================================================================
 */

/*
 * تحويل درجة الحرارة:
 * -------------------
 */
int fahr_to_celsius(fahr)
int fahr;
{
    /*
     * نحسب ونُرجع في سطر واحد:
     */
    return 5 * (fahr - 32) / 9;
}


/*
 * ============================================================================
 * مثال 4: دوال منطقية (Boolean-like)
 * ============================================================================
 */

/*
 * فحص إذا كان العدد زوجي:
 * ------------------------
 * تُرجع 1 إذا زوجي، 0 إذا فردي
 */
int is_even(n)
int n;
{
    /*
     * n % 2 يعطي 0 إذا كان زوجي
     * == 0 يُرجع 1 (true) أو 0 (false)
     */
    return (n % 2 == 0);
}


/*
 * فحص إذا كان العدد موجب:
 */
int is_positive(n)
int n;
{
    return (n > 0);
}


/*
 * فحص إذا كان في نطاق معين:
 */
int in_range(value, min, max)
int value, min, max;
{
    /*
     * && تعني "و" (AND)
     * يُرجع 1 إذا value بين min و max
     */
    return (value >= min && value <= max);
}


/*
 * ============================================================================
 * مثال 5: دوال تعمل على المصفوفات
 * ============================================================================
 */

/*
 * إيجاد أكبر عنصر في مصفوفة:
 * ----------------------------
 */
int find_max(arr, size)
int arr[];
int size;
{
    int max;
    int i;
    
    max = arr[0];
    for (i = 1; i < size; i = i + 1) {
        if (arr[i] > max) {
            max = arr[i];
        }
    }
    
    /*
     * نُرجع القيمة الأكبر:
     */
    return max;
}


/*
 * حساب مجموع المصفوفة:
 */
int array_sum(arr, size)
int arr[];
int size;
{
    int sum;
    int i;
    
    sum = 0;
    for (i = 0; i < size; i = i + 1) {
        sum = sum + arr[i];
    }
    
    return sum;
}


/*
 * البحث في المصفوفة:
 * ------------------
 * تُرجع موقع العنصر أو -1 إذا لم يوجد
 */
int find_in_array(arr, size, target)
int arr[];
int size;
int target;
{
    int i;
    
    for (i = 0; i < size; i = i + 1) {
        if (arr[i] == target) {
            /*
             * return يُنهي الدالة فوراً:
             * لا حاجة للاستمرار في البحث
             */
            return i;
        }
    }
    
    /*
     * إذا وصلنا هنا، لم نجد العنصر:
     */
    return -1;
}


/*
 * ============================================================================
 * الدالة الرئيسية: اختبار الدوال مع return
 * ============================================================================
 */

main()
{
    int result;
    int numbers[5];
    int i, pos;
    
    printf("Example 1: Basic arithmetic functions\n");
    printf("======================================\n\n");
    
    /*
     * استخدام القيم المُرجعة:
     * ------------------------
     * نحفظها في متغير أو نستخدمها مباشرة
     */
    result = add(10, 5);
    printf("10 + 5 = %d\n", result);
    
    result = subtract(10, 5);
    printf("10 - 5 = %d\n", result);
    
    result = multiply(10, 5);
    printf("10 * 5 = %d\n", result);
    
    result = divide(10, 5);
    printf("10 / 5 = %d\n", result);
    
    /*
     * استخدام القيمة المُرجعة مباشرة في printf:
     */
    printf("10 / 0 = %d\n\n", divide(10, 0));
    
    
    printf("Example 2: Power function\n");
    printf("=========================\n\n");
    
    /*
     * استخدام القيمة المُرجعة في تعبير:
     */
    result = power(2, 3) + power(3, 2);
    printf("2^3 + 3^2 = %d + %d = %d\n\n", power(2, 3), power(3, 2), result);
    
    
    printf("Example 3: Temperature conversion\n");
    printf("==================================\n\n");
    
    /*
     * استخدام القيمة المُرجعة في حلقة:
     */
    for (i = 0; i <= 100; i = i + 20) {
        /*
         * نستدعي الدالة ونستخدم قيمتها مباشرة:
         */
        printf("%d°F = %d°C\n", i, fahr_to_celsius(i));
    }
    printf("\n");
    
    
    printf("Example 4: Boolean-like functions\n");
    printf("==================================\n\n");
    
    /*
     * استخدام الدوال المنطقية في شروط:
     */
    for (i = 1; i <= 10; i = i + 1) {
        printf("%d is ", i);
        
        /*
         * استخدام القيمة المُرجعة كشرط:
         */
        if (is_even(i)) {
            printf("even");
        } else {
            printf("odd");
        }
        
        if (in_range(i, 3, 7)) {
            printf(" and in range [3,7]");
        }
        
        printf("\n");
    }
    printf("\n");
    
    
    printf("Example 5: Array functions\n");
    printf("===========================\n\n");
    
    /*
     * تعبئة المصفوفة:
     */
    numbers[0] = 23;
    numbers[1] = 67;
    numbers[2] = 12;
    numbers[3] = 89;
    numbers[4] = 45;
    
    printf("Array: ");
    for (i = 0; i < 5; i = i + 1) {
        printf("%d ", numbers[i]);
    }
    printf("\n");
    
    /*
     * استخدام الدوال التي تُرجع قيم:
     */
    printf("Maximum: %d\n", find_max(numbers, 5));
    printf("Sum: %d\n", array_sum(numbers, 5));
    printf("Average: %d\n", array_sum(numbers, 5) / 5);
    
    /*
     * البحث:
     */
    pos = find_in_array(numbers, 5, 67);
    if (pos != -1) {
        printf("Found 67 at index %d\n", pos);
    } else {
        printf("67 not found\n");
    }
    
    pos = find_in_array(numbers, 5, 100);
    if (pos != -1) {
        printf("Found 100 at index %d\n", pos);
    } else {
        printf("100 not found\n");
    }
}


/*
 * ============================================================================
 * أمثلة متقدمة على استخدام return
 * ============================================================================
 */

/*
 * مثال: دالة تُرجع عدة قيم ممكنة حسب الشروط
 * ---------------------------------------------
 */
int absolute_value(n)
int n;
{
    /*
     * return متعدد:
     * -------------
     * يمكن أن يكون لدينا عدة return في دالة واحدة
     * أول return يُنفذ يُنهي الدالة
     */
    if (n < 0) {
        return -n;  /* إذا سالب، نُرجع موجبه */
    }
    return n;       /* إذا موجب، نُرجعه كما هو */
}


/*
 * حساب المضروب (Factorial):
 */
int factorial(n)
int n;
{
    int result;
    int i;
    
    /*
     * معالجة حالات خاصة:
     */
    if (n < 0) {
        printf("Error: Negative factorial!\n");
        return -1;
    }
    
    if (n == 0 || n == 1) {
        return 1;  /* 0! = 1! = 1 */
    }
    
    /*
     * الحالة العامة:
     */
    result = 1;
    for (i = 2; i <= n; i = i + 1) {
        result = result * i;
    }
    
    return result;
}


/*
 * دالة لحساب الحد الأدنى بين عددين:
 */
int min(a, b)
int a, b;
{
    /*
     * يمكن استخدام تعبير شرطي:
     * (condition) ? value_if_true : value_if_false
     * 
     * لكن في K&R الأولى، نستخدم if:
     */
    if (a < b) {
        return a;
    }
    return b;
}


/*
 * دالة لحساب الحد الأعلى بين عددين:
 */
int max(a, b)
int a, b;
{
    if (a > b) {
        return a;
    }
    return b;
}


/*
 * دالة تستخدم دوال أخرى:
 * ------------------------
 */
int clamp(value, min_val, max_val)
int value, min_val, max_val;
{
    /*
     * تحديد قيمة ضمن نطاق:
     * - إذا أقل من min_val، نُرجع min_val
     * - إذا أكبر من max_val، نُرجع max_val
     * - خلاف ذلك، نُرجع value
     */
    if (value < min_val) {
        return min_val;
    }
    if (value > max_val) {
        return max_val;
    }
    return value;
}


/*
 * اختبار الدوال المتقدمة:
 */
test_advanced_returns()
{
    int i;
    
    printf("\n\nAdvanced Return Examples\n");
    printf("========================\n\n");
    
    /* absolute_value */
    printf("Absolute values:\n");
    printf("|5| = %d\n", absolute_value(5));
    printf("|-5| = %d\n", absolute_value(-5));
    printf("\n");
    
    /* factorial */
    printf("Factorials:\n");
    for (i = 0; i <= 6; i = i + 1) {
        printf("%d! = %d\n", i, factorial(i));
    }
    printf("\n");
    
    /* min and max */
    printf("Min and Max:\n");
    printf("min(10, 20) = %d\n", min(10, 20));
    printf("max(10, 20) = %d\n", max(10, 20));
    printf("\n");
    
    /* clamp */
    printf("Clamp (range 0-100):\n");
    printf("clamp(-10, 0, 100) = %d\n", clamp(-10, 0, 100));
    printf("clamp(50, 0, 100) = %d\n", clamp(50, 0, 100));
    printf("clamp(150, 0, 100) = %d\n", clamp(150, 0, 100));
}


/*
 * ============================================================================
 * Expected Output:
 * ============================================================================
 * Example 1: Basic arithmetic functions
 * ======================================
 * 
 * 10 + 5 = 15
 * 10 - 5 = 5
 * 10 * 5 = 50
 * 10 / 5 = 2
 * Error: Division by zero!
 * 10 / 0 = 0
 * 
 * Example 2: Power function
 * =========================
 * 
 * 2^3 + 3^2 = 8 + 9 = 17
 * 
 * Example 3: Temperature conversion
 * ==================================
 * 
 * 0°F = -17°C
 * 20°F = -6°C
 * 40°F = 4°C
 * 60°F = 15°C
 * 80°F = 26°C
 * 100°F = 37°C
 * 
 * Example 4: Boolean-like functions
 * ==================================
 * 
 * 1 is odd
 * 2 is even
 * 3 is odd and in range [3,7]
 * 4 is even and in range [3,7]
 * 5 is odd and in range [3,7]
 * 6 is even and in range [3,7]
 * 7 is odd and in range [3,7]
 * 8 is even
 * 9 is odd
 * 10 is even
 * 
 * Example 5: Array functions
 * ===========================
 * 
 * Array: 23 67 12 89 45 
 * Maximum: 89
 * Sum: 236
 * Average: 47
 * Found 67 at index 1
 * 100 not found
 * 
 * 
 * Advanced Return Examples
 * ========================
 * 
 * Absolute values:
 * |5| = 5
 * |-5| = 5
 * 
 * Factorials:
 * 0! = 1
 * 1! = 1
 * 2! = 2
 * 3! = 6
 * 4! = 24
 * 5! = 120
 * 6! = 720
 * 
 * Min and Max:
 * min(10, 20) = 10
 * max(10, 20) = 20
 * 
 * Clamp (range 0-100):
 * clamp(-10, 0, 100) = 0
 * clamp(50, 0, 100) = 50
 * clamp(150, 0, 100) = 100
 * 
 * ============================================================================
 * ملاحظات مهمة:
 * ============================================================================
 * 
 * 1. نوع القيمة المُرجعة:
 *    - يجب ذكره عند تعريف الدالة: int add(...)
 *    - نوع القيمة في return يجب أن يطابق
 * 
 * 2. return يُنهي الدالة فوراً:
 *    - أي كود بعد return لن يُنفذ
 *    - مفيد للخروج المبكر من الدالة
 * 
 * 3. return متعدد:
 *    - يمكن أن يكون عدة return في دالة واحدة
 *    - أول return يُنفذ ينهي الدالة
 * 
 * 4. استخدام القيمة المُرجعة:
 *    - حفظها في متغير: result = add(5, 3);
 *    - استخدامها مباشرة: printf("%d", add(5, 3));
 *    - في تعبيرات: x = add(5, 3) * 2;
 *    - في شروط: if (is_even(n))
 * 
 * 5. الدوال بدون return:
 *    - إذا لم تُرجع قيمة، نوعها int ضمنياً في K&R الأولى
 *    - لكن القيمة المُرجعة غير محددة
 *    - في C الحديثة، نستخدم void
 * 
 * 6. القيمة المُرجعة vs الطباعة:
 *    - return أفضل: أكثر مرونة وقابلية لإعادة الاستخدام
 *    - الطباعة مناسبة فقط للخرج النهائي
 * 
 * ============================================================================
 */
